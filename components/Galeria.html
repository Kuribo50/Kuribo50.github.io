<!-- Galería Section Mejorado -->
<section id="galeria" class="py-20 bg-gray-50 relative overflow-hidden">
  <div class="container mx-auto px-4 max-w-7xl">
    <!-- Header -->
    <div class="text-center mb-16" data-aos="fade-up">
      <span class="inline-block px-4 py-2 bg-blue-100 text-blue-900 rounded-full text-sm font-semibold mb-4">
        Nuestra Galería
      </span>
      <h2 class="text-4xl md:text-5xl font-bold text-blue-900 mb-6">
        Proyectos y Trabajos Realizados
      </h2>
      <p class="text-lg text-gray-700 max-w-3xl mx-auto leading-relaxed">
        Conoce algunos de nuestros proyectos más destacados y el trabajo que realizamos para nuestros clientes.
      </p>
    </div>
  
    <!-- Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      <!-- Cada tarjeta tiene data-gallery="galeria" para el lightbox unificado -->
      <div class="group relative overflow-hidden rounded-2xl shadow-lg cursor-pointer gallery-item"
           data-gallery="galeria" data-src="images/SeingSpa/seingspa-2.jpeg" 
           data-title="Instalación Hidráulica Industrial" 
           data-description="Sistema hidráulico completo para planta industrial"
           data-index="0" data-aos="fade-up" data-aos-delay="100">
        <img src="images/SeingSpa/seingspa-2.jpeg" alt="Instalación Hidráulica Industrial"
             class="w-full h-80 object-cover transform group-hover:scale-110 transition-transform duration-700"
             loading="lazy">
        <div class="absolute inset-0 bg-gradient-to-t from-blue-900/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end">
          <div class="p-6 w-full">
            <h3 class="text-xl font-bold text-white mb-2">Instalación Hidráulica Industrial</h3>
            <p class="text-white/90">Sistema hidráulico completo para planta industrial</p>
          </div>
        </div>
      </div>
      
      <div class="group relative overflow-hidden rounded-2xl shadow-lg cursor-pointer gallery-item"
           data-gallery="galeria" data-src="images/SeingSpa/seingspa-3.jpeg" 
           data-title="Mantenimiento Preventivo" 
           data-description="Servicio de mantenimiento en sistema neumático"
           data-index="1" data-aos="fade-up" data-aos-delay="200">
        <img src="images/SeingSpa/seingspa-3.jpeg" alt="Mantenimiento Preventivo"
             class="w-full h-80 object-cover transform group-hover:scale-110 transition-transform duration-700"
             loading="lazy">
        <div class="absolute inset-0 bg-gradient-to-t from-blue-900/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end">
          <div class="p-6 w-full">
            <h3 class="text-xl font-bold text-white mb-2">Mantenimiento Preventivo</h3>
            <p class="text-white/90">Servicio de mantenimiento en sistema neumático</p>
          </div>
        </div>
      </div>
      
      <div class="group relative overflow-hidden rounded-2xl shadow-lg cursor-pointer gallery-item"
           data-gallery="galeria" data-src="images/SeingSpa/seingspa-5.jpeg" 
           data-title="Reparación de Equipos" 
           data-description="Reparación de bomba hidráulica industrial"
           data-index="2" data-aos="fade-up" data-aos-delay="300">
        <img src="images/SeingSpa/seingspa-5.jpeg" alt="Reparación de Equipos"
             class="w-full h-80 object-cover transform group-hover:scale-110 transition-transform duration-700"
             loading="lazy">
        <div class="absolute inset-0 bg-gradient-to-t from-blue-900/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end">
          <div class="p-6 w-full">
            <h3 class="text-xl font-bold text-white mb-2">Reparación de Equipos</h3>
            <p class="text-white/90">Reparación de bomba hidráulica industrial</p>
          </div>
        </div>
      </div>
      
      <div class="group relative overflow-hidden rounded-2xl shadow-lg cursor-pointer gallery-item"
           data-gallery="galeria" data-src="images/SeingSpa/seingspa-6.jpeg" 
           data-title="Instalación Eléctrica" 
           data-description="Sistema de automatización industrial"
           data-index="3" data-aos="fade-up" data-aos-delay="400">
        <img src="images/SeingSpa/seingspa-6.jpeg" alt="Instalación Eléctrica"
             class="w-full h-80 object-cover transform group-hover:scale-110 transition-transform duration-700"
             loading="lazy">
        <div class="absolute inset-0 bg-gradient-to-t from-blue-900/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end">
          <div class="p-6 w-full">
            <h3 class="text-xl font-bold text-white mb-2">Instalación Eléctrica</h3>
            <p class="text-white/90">Sistema de automatización industrial</p>
          </div>
        </div>
      </div>
      
      <div class="group relative overflow-hidden rounded-2xl shadow-lg cursor-pointer gallery-item"
           data-gallery="galeria" data-src="images/SeingSpa/seingspa-7.jpeg" 
           data-title="Proyecto de Modernización" 
           data-description="Actualización de sistema hidráulico"
           data-index="4" data-aos="fade-up" data-aos-delay="500">
        <img src="images/SeingSpa/seingspa-7.jpeg" alt="Proyecto de Modernización"
             class="w-full h-80 object-cover transform group-hover:scale-110 transition-transform duration-700"
             loading="lazy">
        <div class="absolute inset-0 bg-gradient-to-t from-blue-900/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end">
          <div class="p-6 w-full">
            <h3 class="text-xl font-bold text-white mb-2">Proyecto de Modernización</h3>
            <p class="text-white/90">Actualización de sistema hidráulico</p>
          </div>
        </div>
      </div>
      
      <div class="group relative overflow-hidden rounded-2xl shadow-lg cursor-pointer gallery-item"
           data-gallery="galeria" data-src="images/SeingSpa/seingspa-12.jpeg" 
           data-title="Capacitación Técnica" 
           data-description="Sesión de capacitación para personal técnico"
           data-index="5" data-aos="fade-up" data-aos-delay="600">
        <img src="images/SeingSpa/seingspa-12.jpeg" alt="Capacitación Técnica"
             class="w-full h-80 object-cover transform group-hover:scale-110 transition-transform duration-700"
             loading="lazy">
        <div class="absolute inset-0 bg-gradient-to-t from-blue-900/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end">
          <div class="p-6 w-full">
            <h3 class="text-xl font-bold text-white mb-2">Capacitación Técnica</h3>
            <p class="text-white/90">Sesión de capacitación para personal técnico</p>
          </div>
        </div>
      </div>
    </div>
  
    <!-- CTA -->
    <div class="text-center mt-16" data-aos="fade-up" data-aos-duration="800">
      <a href="/galeria.html" class="inline-flex items-center bg-blue-900 text-white px-8 py-3 rounded-full font-semibold hover:bg-blue-800 transition-all duration-300 shadow-lg">
        Ver Galería Completa <i class="fas fa-chevron-right ml-2" aria-hidden="true"></i>
      </a>
    </div>
  </div>
</section>

<!-- Lightbox unificado -->
<div id="lightbox" class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center opacity-0 transition-opacity duration-300" role="dialog" aria-modal="true" aria-label="Galería de imágenes">
  <div class="relative w-full h-full flex flex-col items-center justify-center">
    <!-- Controles de navegación -->
    <button id="lightbox-close" class="absolute top-6 right-8 text-white text-3xl font-bold hover:text-blue-400 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-400 rounded-full p-1 z-20" aria-label="Cerrar galería">
      <span aria-hidden="true">&times;</span>
    </button>

    <button id="lightbox-prev" class="absolute left-6 md:left-10 top-1/2 -translate-y-1/2 text-white text-3xl font-bold hover:text-blue-400 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-400 rounded-full p-2 z-20" aria-label="Imagen anterior">
      <span aria-hidden="true">&#10094;</span>
    </button>

    <div class="relative max-w-5xl mx-auto">
      <img id="lightbox-img" src="" alt="" class="max-h-[80vh] max-w-[90vw] md:max-w-[80vw] rounded-2xl shadow-2xl border-2 border-white/20 object-contain opacity-0 transition-opacity duration-300" />
      
      <!-- Contador de imágenes -->
      <div id="lightbox-counter" class="absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/50 text-white px-4 py-1 rounded-full text-sm">
        <span id="current-index">1</span> / <span id="total-images">6</span>
      </div>
      
      <!-- Descripción de imagen -->
      <div id="lightbox-caption" class="absolute -bottom-12 left-0 right-0 text-center text-white text-lg font-medium"></div>
    </div>

    <button id="lightbox-next" class="absolute right-6 md:right-10 top-1/2 -translate-y-1/2 text-white text-3xl font-bold hover:text-blue-400 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-400 rounded-full p-2 z-20" aria-label="Imagen siguiente">
      <span aria-hidden="true">&#10095;</span>
    </button>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Lightbox optimizado y mejorado
    const lightbox = (() => {
      // Elementos del DOM
      const lightboxEl = document.getElementById('lightbox');
      const imageEl = document.getElementById('lightbox-img');
      const captionEl = document.getElementById('lightbox-caption');
      const currentIndexEl = document.getElementById('current-index');
      const totalImagesEl = document.getElementById('total-images');
      const prevBtn = document.getElementById('lightbox-prev');
      const nextBtn = document.getElementById('lightbox-next');
      const closeBtn = document.getElementById('lightbox-close');
      
      // Datos
      let galleries = {};
      let currentGallery = '';
      let currentIndex = 0;
      let isTransitioning = false;
      
      // Inicializar
      function init() {
        // Recopilar todos los elementos de galería
        const galleryItems = document.querySelectorAll('.gallery-item');
        
        galleryItems.forEach(item => {
          const galleryName = item.dataset.gallery;
          const imageSrc = item.dataset.src || item.querySelector('img').src;
          const imageAlt = item.querySelector('img').alt;
          const title = item.dataset.title || item.querySelector('h3')?.textContent || '';
          const description = item.dataset.description || item.querySelector('p')?.textContent || '';
          const index = parseInt(item.dataset.index || '0');
          
          // Crear grupo de galería si no existe
          if (!galleries[galleryName]) {
            galleries[galleryName] = [];
          }
          
          // Agregar imagen a la galería
          galleries[galleryName][index] = {
            src: imageSrc,
            alt: imageAlt,
            title: title,
            description: description
          };
          
          // Agregar evento de clic
          item.addEventListener('click', () => {
            openGallery(galleryName, index);
          });
          
          // Mejorar accesibilidad
          item.setAttribute('role', 'button');
          item.setAttribute('tabindex', '0');
          item.setAttribute('aria-label', `Ver imagen: ${title}`);
          
          // Soporte para teclado
          item.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              openGallery(galleryName, index);
            }
          });
        });
        
        // Eventos de control del lightbox
        closeBtn.addEventListener('click', close);
        prevBtn.addEventListener('click', prev);
        nextBtn.addEventListener('click', next);
        
        // Cerrar al hacer clic fuera de la imagen
        lightboxEl.addEventListener('click', (e) => {
          if (e.target === lightboxEl) {
            close();
          }
        });
        
        // Soporte para teclado global
        document.addEventListener('keydown', (e) => {
          if (!lightboxEl.classList.contains('hidden')) {
            if (e.key === 'Escape') close();
            if (e.key === 'ArrowLeft') prev();
            if (e.key === 'ArrowRight') next();
          }
        });
      }
      
      // Abrir galería
      function openGallery(galleryName, index) {
        if (!galleries[galleryName]) return;
        
        currentGallery = galleryName;
        currentIndex = index;
        
        // Actualizar total de imágenes
        const gallery = galleries[galleryName];
        totalImagesEl.textContent = Object.keys(gallery).length.toString();
        
        // Mostrar imagen
        showImage(index);
        
        // Mostrar lightbox
        lightboxEl.classList.remove('hidden');
        setTimeout(() => {
          lightboxEl.classList.add('opacity-100');
        }, 10);
        
        // Deshabilitar scroll en el body
        document.body.style.overflow = 'hidden';
      }
      
      // Mostrar imagen
      function showImage(index) {
        if (isTransitioning) return;
        isTransitioning = true;
        
        const gallery = galleries[currentGallery];
        const image = gallery[index];
        
        if (!image) {
          isTransitioning = false;
          return;
        }
        
        // Ocultar imagen actual
        imageEl.classList.remove('opacity-100');
        imageEl.classList.add('opacity-0');
        
        setTimeout(() => {
          // Actualizar imagen
          imageEl.src = image.src;
          imageEl.alt = image.alt;
          
          // Actualizar información
          captionEl.textContent = `${image.title} - ${image.description}`;
          currentIndexEl.textContent = (index + 1).toString();
          
          // Esperar a que cargue la imagen y mostrarla
          imageEl.onload = () => {
            imageEl.classList.remove('opacity-0');
            imageEl.classList.add('opacity-100');
            isTransitioning = false;
          };
          
          // Si hay error, también liberar bloqueo
          imageEl.onerror = () => {
            isTransitioning = false;
          };
        }, 300);
      }
      
      // Anterior imagen
      function prev() {
        if (isTransitioning) return;
        
        const gallery = galleries[currentGallery];
        const keys = Object.keys(gallery).map(Number).sort((a, b) => a - b);
        const currentPos = keys.indexOf(currentIndex);
        const prevPos = (currentPos - 1 + keys.length) % keys.length;
        
        currentIndex = keys[prevPos];
        showImage(currentIndex);
      }
      
      // Siguiente imagen
      function next() {
        if (isTransitioning) return;
        
        const gallery = galleries[currentGallery];
        const keys = Object.keys(gallery).map(Number).sort((a, b) => a - b);
        const currentPos = keys.indexOf(currentIndex);
        const nextPos = (currentPos + 1) % keys.length;
        
        currentIndex = keys[nextPos];
        showImage(currentIndex);
      }
      
      // Cerrar lightbox
      function close() {
        lightboxEl.classList.remove('opacity-100');
        
        setTimeout(() => {
          lightboxEl.classList.add('hidden');
          imageEl.src = '';
          document.body.style.overflow = '';
        }, 300);
      }
      
      // API pública
      return {
        init
      };
    })();
    
    // Inicializar lightbox
    lightbox.init();
    
    // Inicializar lazy loading si está disponible
    if ('IntersectionObserver' in window) {
      const lazyImageObserver = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const lazyImage = entry.target;
            if (lazyImage.dataset.src) {
              lazyImage.src = lazyImage.dataset.src;
              lazyImage.removeAttribute('data-src');
            }
            lazyImageObserver.unobserve(lazyImage);
          }
        });
      });
      document.querySelectorAll('img[data-src]').forEach((img) => {
        lazyImageObserver.observe(img);
      });
    }
    // Inicializar AOS para animaciones si está disponible
    if (typeof AOS !== 'undefined') {
      AOS.init({
        once: true,
        duration: 750,
        offset: 100
      });
    }
  });
</script>